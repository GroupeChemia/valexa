<script>
    const { ipcRenderer } = require('electron');
    const loadBalancer = require('electron-load-balancer');
    const { PythonShell } = require('python-shell')
    const path = require('path');
    const json_dataset = {"Validation": [{"Serie": 1, "Level": 1, "x": 25.3533, "y": 0.0439}, {"Serie": 1, "Level": 1, "x": 25.3533, "y": 0.0488}, {"Serie": 1, "Level": 1, "x": 25.3533, "y": 0.048}, {"Serie": 1, "Level": 1, "x": 25.3533, "y": 0.0484}, {"Serie": 1, "Level": 2, "x": 48.2417, "y": 0.0949}, {"Serie": 1, "Level": 2, "x": 48.2417, "y": 0.0927}, {"Serie": 1, "Level": 2, "x": 48.2417, "y": 0.0887}, {"Serie": 1, "Level": 2, "x": 48.2417, "y": 0.1015}, {"Serie": 1, "Level": 3, "x": 437.8235, "y": 0.9873}, {"Serie": 1, "Level": 3, "x": 437.8235, "y": 1.0136}, {"Serie": 1, "Level": 3, "x": 437.8235, "y": 1.0288}, {"Serie": 1, "Level": 3, "x": 437.8235, "y": 1.0173}, {"Serie": 1, "Level": 4, "x": 838.6479, "y": 2.022}, {"Serie": 1, "Level": 4, "x": 838.6479, "y": 1.9901}, {"Serie": 1, "Level": 4, "x": 838.6479, "y": 2.0937}, {"Serie": 1, "Level": 4, "x": 838.6479, "y": 2.0189}, {"Serie": 2, "Level": 1, "x": 25.3533, "y": 0.0371}, {"Serie": 2, "Level": 1, "x": 25.3533, "y": 0.0422}, {"Serie": 2, "Level": 1, "x": 25.3533, "y": 0.0461}, {"Serie": 2, "Level": 1, "x": 25.3533, "y": 0.0448}, {"Serie": 2, "Level": 2, "x": 48.2417, "y": 0.0922}, {"Serie": 2, "Level": 2, "x": 48.2417, "y": 0.0916}, {"Serie": 2, "Level": 2, "x": 48.2417, "y": 0.0854}, {"Serie": 2, "Level": 2, "x": 48.2417, "y": 0.0918}, {"Serie": 2, "Level": 3, "x": 437.8235, "y": 0.9718}, {"Serie": 2, "Level": 3, "x": 437.8235, "y": 1.0322}, {"Serie": 2, "Level": 3, "x": 437.8235, "y": 1.0342}, {"Serie": 2, "Level": 3, "x": 437.8235, "y": 1.0319}, {"Serie": 2, "Level": 4, "x": 838.6479, "y": 1.9252}, {"Serie": 2, "Level": 4, "x": 838.6479, "y": 2.0284}, {"Serie": 2, "Level": 4, "x": 838.6479, "y": 2.0127}, {"Serie": 2, "Level": 4, "x": 838.6479, "y": 2.0273}, {"Serie": 3, "Level": 1, "x": 25.3533, "y": 0.0444}, {"Serie": 3, "Level": 1, "x": 25.3533, "y": 0.0457}, {"Serie": 3, "Level": 1, "x": 25.3533, "y": 0.0502}, {"Serie": 3, "Level": 1, "x": 25.3533, "y": 0.0475}, {"Serie": 3, "Level": 2, "x": 48.2417, "y": 0.0956}, {"Serie": 3, "Level": 2, "x": 48.2417, "y": 0.1023}, {"Serie": 3, "Level": 2, "x": 48.2417, "y": 0.1007}, {"Serie": 3, "Level": 2, "x": 48.2417, "y": 0.1092}, {"Serie": 3, "Level": 3, "x": 437.8235, "y": 1.0392}, {"Serie": 3, "Level": 3, "x": 437.8235, "y": 1.1132}, {"Serie": 3, "Level": 3, "x": 437.8235, "y": 1.1419}, {"Serie": 3, "Level": 3, "x": 437.8235, "y": 1.0751}, {"Serie": 3, "Level": 4, "x": 838.6479, "y": 2.1272}, {"Serie": 3, "Level": 4, "x": 838.6479, "y": 2.2127}, {"Serie": 3, "Level": 4, "x": 838.6479, "y": 2.2699}, {"Serie": 3, "Level": 4, "x": 838.6479, "y": 2.2546}], "Calibration": [{"Serie": 1, "Level": 1, "x": 25.3533, "y": 0.0485}, {"Serie": 1, "Level": 1, "x": 25.3533, "y": 0.0448}, {"Serie": 1, "Level": 2, "x": 48.2417, "y": 0.0959}, {"Serie": 1, "Level": 2, "x": 48.2417, "y": 0.087}, {"Serie": 1, "Level": 3, "x": 96.4833, "y": 0.1974}, {"Serie": 1, "Level": 3, "x": 96.4833, "y": 0.2057}, {"Serie": 1, "Level": 4, "x": 223.8496, "y": 0.5589}, {"Serie": 1, "Level": 4, "x": 223.8496, "y": 0.5667}, {"Serie": 1, "Level": 5, "x": 437.8235, "y": 1.1041}, {"Serie": 1, "Level": 5, "x": 437.8235, "y": 1.0961}, {"Serie": 1, "Level": 6, "x": 964.8233, "y": 2.396}, {"Serie": 1, "Level": 6, "x": 964.8233, "y": 2.3861}, {"Serie": 2, "Level": 1, "x": 25.3533, "y": 0.0358}, {"Serie": 2, "Level": 1, "x": 25.3533, "y": 0.0402}, {"Serie": 2, "Level": 2, "x": 48.2417, "y": 0.1025}, {"Serie": 2, "Level": 2, "x": 48.2417, "y": 0.0993}, {"Serie": 2, "Level": 3, "x": 96.4833, "y": 0.2046}, {"Serie": 2, "Level": 3, "x": 96.4833, "y": 0.1996}, {"Serie": 2, "Level": 4, "x": 223.8496, "y": 0.5371}, {"Serie": 2, "Level": 4, "x": 223.8496, "y": 0.5066}, {"Serie": 2, "Level": 5, "x": 437.8235, "y": 0.9963}, {"Serie": 2, "Level": 5, "x": 437.8235, "y": 1.0568}, {"Serie": 2, "Level": 6, "x": 964.8233, "y": 2.2877}, {"Serie": 2, "Level": 6, "x": 964.8233, "y": 2.25}, {"Serie": 3, "Level": 1, "x": 25.3533, "y": 0.0449}, {"Serie": 3, "Level": 1, "x": 25.3533, "y": 0.0415}, {"Serie": 3, "Level": 2, "x": 48.2417, "y": 0.0987}, {"Serie": 3, "Level": 2, "x": 48.2417, "y": 0.0892}, {"Serie": 3, "Level": 3, "x": 96.4833, "y": 0.2036}, {"Serie": 3, "Level": 3, "x": 96.4833, "y": 0.2082}, {"Serie": 3, "Level": 4, "x": 223.8496, "y": 0.5095}, {"Serie": 3, "Level": 4, "x": 223.8496, "y": 0.5756}, {"Serie": 3, "Level": 5, "x": 437.8235, "y": 1.1726}, {"Serie": 3, "Level": 5, "x": 437.8235, "y": 1.1772}, {"Serie": 3, "Level": 6, "x": 964.8233, "y": 2.4528}, {"Serie": 3, "Level": 6, "x": 964.8233, "y": 2.3147}]}

    let pyshell = new PythonShell('interface.py', {
        pythonPath: path.join(process.env["npm_config_prefix"], '\\python'),
        pythonOptions: ['-u'],
        args: ['test', JSON.stringify(json_dataset)]
    } )

    loadBalancer.job(
        ipcRenderer,
        'test',
        () => {
            pyshell.on('message', function(message) {
                ipcRenderer.send("GEN_MESSAGE", message)
                if (message === "EXIT") {
                    console.log("stop")
                    loadBalancer.stop(ipcRenderer, 'test')
                } else {
                    try {
                        const parsedJSON = JSON.parse(message)
                        switch (parsedJSON['type']) {
                            case 'PROFILE':
                                ipcRenderer.send("PROFILE", {
                                    data: parsedJSON['data']
                                })
                                break
                        }
                    } catch (e) {
                        console.log(e)
                    }
                }
            })
        },
        () => {
            pyshell.terminate()
        });

</script>